# CryptoLuck Bot

CryptoLuck — асинхронный Telegram-бот для покупки лотерейных билетов за криптовалюту с автоматическим еженедельным розыгрышем приза и уведомлениями на 4 языках.

Основные возможности
- Покупка билетов: 0.10 USD = 1 билет. Поддержка оптовой покупки (несколько билетов одним платежом).
- Поддерживаемые валюты: XRP / TRX / HBAR / USDTTRC20 (настраивается).
- Платежи: интеграция с NOWPayments (ссылка/адрес + QR, IPN вебхук и/или опрос статуса).
- Хранение: пользователи, их кошельки (по монетам), язык интерфейса, билеты, текущий банк.
- Розыгрыш: автоматический по расписанию (четверг 20:00 America/Caracas), честный выбор победителя пропорционально количеству билетов.
- Выплаты: отправка приза победителю, распределение остатка на кошельки организаторов.
- Уведомления: 
  - приветственное изображение;
  - картинка победы (с указанием победного хэша и частично замаскированным user id);
  - картинка переноса банка, если порог не достигнут.
- I18n: все кнопки и тексты доступны на EN / ES / PT / FR.
- Надежность: идемпотентность начислений, обработка ошибок, ретраи, журналирование.

Архитектура (высокоуровнево)
- Aiogram 3 — Telegram-бот (long polling).
- FastAPI — веб-сервер для IPN NOWPayments и тех. эндпоинтов.
- SQLAlchemy — ORM. SQLite для разработки и PostgreSQL (через asyncpg) для продакшна.
- APScheduler — планировщик еженедельного розыгрыша (cron, TZ America/Caracas).
- httpx — внешние HTTP-запросы к NOWPayments и пр.
- qrcode + Pillow — генерация QR и изображений.
- python-dotenv — конфигурация окружения.
- cryptography — криптоутилиты при необходимости (подпись/проверка и др.).

Бизнес-правила
- Порог розыгрыша: банк >= 10 USD (эквивалент >= 100 билетов) к моменту четверга 20:00 America/Caracas.
- Если порог не достигнут — банк переносится, билеты остаются активными.
- При розыгрыше:
  - выбирается победитель пропорционально количеству купленных им билетов;
  - приз = 10 USD;
  - остаток (банк − 10 USD) распределяется на кошельки организаторов;
  - билеты обнуляются, стартует новый цикл.
- Источник «победного хэша» указывается в уведомлении (конкретный источник настраивается).

Модель данных (упрощенно)
- Users: user_id, username/имя, язык, кошельки по монетам.
- Tickets/Entries: активные билеты пользователя текущего раунда (возможна реализация и через поле в Users).
- Lottery: состояние текущего раунда (total_collected/метаданные/победитель/статусы).
- Payments (опционально): история платежей (аудит, отладка).

Переменные окружения (.env)
Пример (не коммитить реальные секреты, используйте плейсхолдеры):

# 1) Создать виртуальное окружение
python -m virtualenv .venv source .venv/bin/activate
# 2) Установить зависимости
pip install -r requirements.txt
# 3) Подготовить окружение
cp .env.sample .env # если есть шаблон; иначе создайте .env по примеру выше mkdir -p data
# 4) Инициализация БД (если предусмотрен скрипт/миграции)
# python -m app.db.init # пример, если реализовано
# 5) Запуск (long polling бота и FastAPI/IPN)
python -m app.main
